# üöÄ Gu√≠a Completa: Configurar Laravel Sail en Windows 11
## Con Problemas Reales y Soluciones Probadas (Versi√≥n Actualizada)

> **Autor:** Basado en la experiencia real de configuraci√≥n en Windows 11  
> **Fecha:** Junio 2025  
> **Objetivo:** Levantar un proyecto Laravel con Docker Sail desde GitHub

---

## üìã **Tabla de Contenidos**

1. [Requisitos Previos](#requisitos-previos)
2. [Instalaci√≥n de Herramientas Base](#instalaci√≥n-de-herramientas-base)
3. [Configuraci√≥n de WSL](#configuraci√≥n-de-wsl)
4. [Instalaci√≥n de Docker Desktop](#instalaci√≥n-de-docker-desktop)
5. [Clonado y Configuraci√≥n del Proyecto](#clonado-y-configuraci√≥n-del-proyecto)
6. [Problemas Encontrados y Soluciones](#problemas-encontrados-y-soluciones)
7. [Configuraci√≥n del Dominio Personalizado](#configuraci√≥n-del-dominio-personalizado)
8. [Configuraci√≥n del Alias de Sail](#configuraci√≥n-del-alias-de-sail)
9. [Configuraci√≥n del Gestor de Base de Datos](#configuraci√≥n-del-gestor-de-base-de-datos)
10. [Comandos √ötiles](#comandos-√∫tiles)
11. [Conclusiones](#conclusiones)

---

## üîß **Requisitos Previos**

- **Windows 11** (probado en esta versi√≥n)
- **Conexi√≥n a internet estable**
- **Permisos de administrador**
- **Al menos 8GB de RAM** (recomendado)
- **20GB de espacio libre** en disco

---

## üõ†Ô∏è **Instalaci√≥n de Herramientas Base**

### 1. Instalar WSL (Windows Subsystem for Linux)

**¬øPor qu√© WSL?** Laravel Sail est√° optimizado para entornos Unix/Linux.

```powershell
# Ejecutar en PowerShell como Administrador
wsl --install
```

**‚ö†Ô∏è PROBLEMA ENCONTRADO:** Despu√©s de instalar WSL, Windows requiere reinicio.

**‚úÖ SOLUCI√ìN:** 
1. Reiniciar la computadora obligatoriamente
2. Al reiniciar, se abrir√° una terminal autom√°ticamente para configurar Ubuntu
3. Crear usuario y contrase√±a cuando se solicite

### 2. Verificar Instalaci√≥n de WSL

```bash
# Verificar versi√≥n de WSL
wsl --version

# Verificar distribuciones instaladas
wsl --list --verbose
```

---

## üê≥ **Instalaci√≥n de Docker Desktop**

### 1. Descargar Docker Desktop

- Ir a: https://www.docker.com/products/docker-desktop/
- Descargar la versi√≥n para Windows
- **Importante:** Asegurarse de que incluya soporte para WSL 2

### 2. Instalaci√≥n

1. Ejecutar el instalador como administrador
2. **‚úÖ MARCAR:** "Use WSL 2 instead of Hyper-V" durante la instalaci√≥n
3. Completar instalaci√≥n y reiniciar si es necesario

### 3. Configuraci√≥n Post-Instalaci√≥n

**‚ö†Ô∏è PROBLEMA ENCONTRADO:** Docker Desktop no se integra autom√°ticamente con WSL.

**‚úÖ SOLUCI√ìN:**
1. Abrir Docker Desktop
2. Ir a **Settings** ‚Üí **Resources** ‚Üí **WSL Integration**
3. **Activar:** "Enable integration with my default WSL distro"
4. **Activar:** La distribuci√≥n Ubuntu espec√≠fica
5. Hacer clic en **"Apply & Restart"**

### 4. Verificar Funcionamiento

```bash
# Desde terminal WSL
docker --version
docker-compose --version

# Probar Docker
docker run hello-world
```

---

## üìÅ **Clonado y Configuraci√≥n del Proyecto**

### 1. Configurar Git (si no est√° configurado)

```bash
git config --global user.name "Tu Nombre"
git config --global user.email "tu.email@ejemplo.com"
```

### 2. Crear Estructura de Directorios

```bash
# Crear directorio para proyectos
mkdir ~/proyectos
cd ~/proyectos
```

### 3. Clonar el Proyecto

```bash
# Clonar proyecto desde GitHub
git clone https://github.com/usuario/laravel_avanzado.git
cd laravel_avanzado
```

### 4. Verificar Contenido del Proyecto

```bash
# Verificar que existe el archivo sail
ls -la vendor/bin/sail

# Si no existe vendor/, instalar dependencias primero
composer install
```

---

## üêõ **Problemas Encontrados y Soluciones**

### **Problema 1: Comando `sail` no encontrado**

**‚ùå Error:**
```bash
$ sail ps
Command 'sail' not found, but can be installed with:
sudo apt install bsdgames
```

**‚úÖ SOLUCI√ìN:**
Sail no es un comando global, debe ejecutarse desde el directorio del proyecto:

```bash
# Forma correcta
./vendor/bin/sail ps

# Crear alias (ver secci√≥n espec√≠fica m√°s adelante)
```

### **Problema 2: Conflicto de Puertos con Apache**

**‚ùå Error:** Al acceder a `localhost` se muestra la p√°gina de Apache en lugar de Laravel.

**üîç DIAGN√ìSTICO:**
```bash
# Ver puertos mapeados
./vendor/bin/sail ps
```

**‚úÖ SOLUCI√ìN:**
1. Identificar el puerto correcto de Laravel en la salida de `sail ps`
2. Si Apache est√° usando el puerto 80, detenerlo:
   ```bash
   sudo service apache2 stop
   ```
3. Acceder a Laravel en el puerto correcto (ej: `localhost:8080`)

### **Problema 3: Puerto 8080 no responde**

**‚ùå Error:** `localhost:8080` muestra "This site can't be reached"

**üîç DIAGN√ìSTICO:**
```bash
# Verificar logs del contenedor
./vendor/bin/sail logs laravel.test
```

**‚úÖ SOLUCI√ìN:**
Los logs mostraron que Laravel estaba sirviendo en puerto 80 interno, mapeado al 80 externo:
1. Detener Apache local: `sudo service apache2 stop`
2. Acceder a: `http://localhost` (puerto 80)

### **Problema 4: Dominio Personalizado**

**‚ùå Error:** `laravel_avanzado.test` no funciona, solo `localhost`

**ÔøΩÔøΩ CAUSA:** El comando PowerShell agreg√≥ espacios entre caracteres:
```bash
echo "127.0.0.1 laravel_avanzado.test" >> C:\Windows\System32\drivers\etc\hosts
```

**‚úÖ SOLUCI√ìN:**
1. Abrir como administrador:
   ```powershell
   notepad C:\Windows\System32\drivers\etc\hosts
   ```
2. Agregar manualmente al final:
   ```
   127.0.0.1 laravel_avanzado.test
   ```
3. Guardar y cerrar
4. Limpiar cach√© DNS:
   ```powershell
   ipconfig /flushdns
   ```

### **Problema 5: Alias de Sail - PATH Corrupto**

**‚ùå Error:** Despu√©s de crear alias y ejecutar `source ~/.bashrc`, todos los comandos b√°sicos fallan:
```bash
$ grep
Command 'grep' is available in the following places
 * /bin/grep
 * /usr/bin/grep
The command could not be located because '/usr/bin:/bin' is not included in the PATH environment variable.
grep: command not found
```

**üîç CAUSA:** En `.bashrc` hab√≠a una l√≠nea que sobrescrib√≠a completamente el PATH:
```bash
export PATH="/home/r10/.config/composer/vendor/bin/"
```

**‚úÖ SOLUCI√ìN:**
1. Editar `.bashrc`:
   ```bash
   nano ~/.bashrc
   ```
2. Cambiar la l√≠nea problem√°tica de:
   ```bash
   export PATH="/home/r10/.config/composer/vendor/bin/"
   ```
   **A:**
   ```bash
   export PATH="/home/r10/.config/composer/vendor/bin:$PATH"
   ```
3. **¬°Importante!** El `:$PATH` al final agrega la ruta sin sobrescribir el PATH existente
4. Guardar y recargar:
   ```bash
   source ~/.bashrc
   ```

---

## üåê **Configuraci√≥n del Dominio Personalizado**

### 1. Modificar Archivo Hosts

**En Windows (como Administrador):**
```powershell
notepad C:\Windows\System32\drivers\etc\hosts
```

Agregar al final:
```
127.0.0.1 laravel_avanzado.test
```

### 2. Actualizar Laravel .env

```bash
# Editar archivo .env
nano .env

# Cambiar la l√≠nea APP_URL
APP_URL=http://laravel_avanzado.test
```

### 3. Reiniciar Sail

```bash
./vendor/bin/sail down
./vendor/bin/sail up
```

### 4. Acceder al Proyecto

Abrir navegador en: **http://laravel_avanzado.test**

---

## ‚ö° **Configuraci√≥n del Alias de Sail**

### **¬øPor qu√© necesitas un alias?**

En lugar de escribir `./vendor/bin/sail` cada vez, podr√°s usar simplemente `sail`.

### **Paso 1: Verificar el Estado Actual**

```bash
# Verificar si hay aliases conflictivos
grep -n "sail" ~/.bashrc

# Ver el PATH actual
echo $PATH
```

### **Paso 2: Limpiar Configuraciones Anteriores (si las hay)**

```bash
# Eliminar l√≠neas previas de sail si existen
sed -i '/sail/d' ~/.bashrc
```

### **Paso 3: Verificar/Arreglar la Configuraci√≥n del PATH**

**‚ö†Ô∏è CR√çTICO:** Antes de agregar el alias, asegurarse de que el PATH est√© correctamente configurado.

```bash
# Revisar el contenido de .bashrc
cat ~/.bashrc | grep "export PATH"
```

**Si encuentras una l√≠nea como:**
```bash
export PATH="/home/usuario/.config/composer/vendor/bin/"
```

**C√°mbiala por:**
```bash
export PATH="/home/usuario/.config/composer/vendor/bin:$PATH"
```

### **Paso 4: Agregar el Alias**

```bash
# Agregar alias con ruta absoluta
echo "alias sail='/home/r10/proyectos/laravel_avanzado/vendor/bin/sail'" >> ~/.bashrc
```

**Nota:** Cambia `/home/r10/` por tu ruta de usuario real.

### **Paso 5: Recargar Configuraci√≥n**

```bash
source ~/.bashrc
```

### **Paso 6: Verificar Funcionamiento**

```bash
# Verificar que el alias existe
alias | grep sail

# Verificar que los comandos b√°sicos siguen funcionando
grep --version
ls --version

# Probar el alias desde cualquier directorio
cd ~
sail ps
```

### **Resultado Esperado**

Deber√≠as poder ejecutar:
```bash
sail up
sail down
sail ps
sail artisan migrate
```

Desde **cualquier directorio** sin problemas.

---

## üóÑÔ∏è **Configuraci√≥n del Gestor de Base de Datos**

### **Recomendaci√≥n: DBeaver Community**

**¬øPor qu√© DBeaver?**
- ‚úÖ Gratuito y open source
- ‚úÖ Multiplataforma
- ‚úÖ Soporta MySQL, PostgreSQL, SQLite, etc.
- ‚úÖ Interfaz moderna y limpia

### **Instalaci√≥n**

1. Descargar desde: https://dbeaver.io/
2. Instalar normalmente en Windows

### **Configuraci√≥n de Conexi√≥n**

**Datos de conexi√≥n:**
- **Host:** `localhost`
- **Puerto:** `3306`
- **Database:** `laravel_avanzado` (o el nombre en tu .env)
- **Usuario:** `sail`
- **Contrase√±a:** `password`

### **Problema Com√∫n: "Public Key Retrieval is not allowed"**

**‚úÖ SOLUCI√ìN:**
1. En la configuraci√≥n de conexi√≥n, ir a **"Driver properties"**
2. Agregar estas propiedades:
   ```
   allowPublicKeyRetrieval = true
   useSSL = false
   ```

### **Verificaci√≥n**

Una vez conectado, deber√≠as ver las tablas de Laravel:
- `users`
- `migrations`
- `cache`
- `jobs`
- `sessions`
- Y m√°s...

---

## üîß **Comandos √ötiles**

### Comandos Docker/Sail B√°sicos

```bash
# Iniciar entorno
sail up

# Iniciar en background
sail up -d

# Parar entorno
sail down

# Ver estado de contenedores
sail ps

# Ver logs
sail logs

# Acceder al contenedor
sail shell
```

### Comandos Laravel

```bash
# Migrar base de datos
sail artisan migrate

# Crear controlador
sail artisan make:controller MiController

# Crear modelo
sail artisan make:model MiModelo

# Limpiar cach√©
sail artisan cache:clear

# Generar clave de aplicaci√≥n
sail artisan key:generate
```

### Comandos de Debugging

```bash
# Ver configuraci√≥n Docker
docker ps

# Ver logs espec√≠ficos
sail logs laravel.test

# Verificar puertos en uso
netstat -tulpn | grep :80

# Verificar PATH actual
echo $PATH

# Verificar aliases
alias | grep sail
```

---

## ‚ö° **Flujo de Trabajo Diario**

### Al Iniciar el D√≠a

```bash
# 1. Abrir WSL
wsl

# 2. Ir al proyecto (o usar el alias desde cualquier lado)
cd ~/proyectos/laravel_avanzado

# 3. Iniciar entorno
sail up -d

# 4. Verificar que funciona
curl http://laravel_avanzado.test
```

### Al Terminar el D√≠a

```bash
# Parar entorno para liberar recursos
sail down
```

---

## üéØ **Consejos Importantes**

### ‚úÖ **Buenas Pr√°cticas**

1. **Siempre usar WSL** para comandos de desarrollo
2. **Verificar integraci√≥n Docker-WSL** antes de empezar
3. **Cuidar la configuraci√≥n del PATH** en `.bashrc`
4. **Detener Apache local** si causa conflictos de puerto
5. **Editar hosts manualmente** en lugar de usar comandos PowerShell
6. **Usar alias con ruta absoluta** para evitar problemas de directorio

### ‚ö†Ô∏è **Errores Comunes a Evitar**

1. **No reiniciar** despu√©s de instalar WSL
2. **Ejecutar Docker** desde PowerShell en lugar de WSL
3. **Sobrescribir el PATH** en lugar de agregarlo (usar `:$PATH`)
4. **Olvidar detener Apache** local
5. **Usar comandos PowerShell** para editar archivos cr√≠ticos del sistema
6. **No verificar el PATH** antes de crear aliases

---

## üêõ **Troubleshooting R√°pido**

| Problema | Verificaci√≥n | Soluci√≥n |
|----------|--------------|----------|
| `sail` no funciona | `ls vendor/bin/sail` | Usar `./vendor/bin/sail` o crear alias |
| Puerto ocupado | `sail ps` | Detener Apache: `sudo service apache2 stop` |
| Docker no responde | `docker ps` | Verificar integraci√≥n WSL en Docker Desktop |
| Dominio no funciona | `ping laravel_avanzado.test` | Editar hosts manualmente |
| Comandos b√°sicos fallan | `echo $PATH` | Arreglar PATH en `.bashrc` |
| Alias no funciona | `alias \| grep sail` | Verificar ruta absoluta en alias |
| Contenedor no inicia | `sail logs` | Revisar logs para errores espec√≠ficos |

---

## üéâ **Resultado Final**

Despu√©s de seguir esta gu√≠a tendr√°s:

- ‚úÖ **WSL 2** funcionando con Ubuntu
- ‚úÖ **Docker Desktop** integrado con WSL
- ‚úÖ **Laravel Sail** levantando tu proyecto
- ‚úÖ **Dominio personalizado** (laravel_avanzado.test)
- ‚úÖ **Alias de sail** funcionando desde cualquier directorio
- ‚úÖ **Base de datos MySQL** en contenedor
- ‚úÖ **DBeaver** conectado para gestionar la BD
- ‚úÖ **Entorno de desarrollo** completamente funcional

---

## üìù **Conclusiones**

### **Lo Bueno:**
- Una vez configurado, el entorno es estable y reproducible
- Docker isola dependencias y evita conflictos
- Sail simplifica la gesti√≥n de servicios Laravel
- El alias hace el trabajo diario mucho m√°s fluido

### **Lo Malo:**
- Windows a√±ade complejidad innecesaria
- Configuraci√≥n inicial toma tiempo
- Errores cr√≠pticos requieren experiencia para resolver
- La gesti√≥n del PATH en WSL puede ser traicionera

### **Lo Aprendido:**
- **DevOps es complejo al principio** pero vale la pena
- **Cada error ense√±a** algo importante
- **La paciencia es clave** en la configuraci√≥n inicial
- **La documentaci√≥n salva vidas** (y tiempo futuro)

### **Recomendaci√≥n Final:**
> Si es posible, considera migrar a **macOS** o **Linux** para desarrollo web. La experiencia es significativamente mejor. Mientras tanto, esta gu√≠a te permitir√° trabajar productivamente en Windows con todas las comodidades.

---

## üîó **Enlaces √ötiles**

- [Documentaci√≥n Laravel Sail](https://laravel.com/docs/sail)
- [Docker Desktop WSL 2](https://docs.docker.com/desktop/wsl/)
- [Gu√≠a WSL Microsoft](https://docs.microsoft.com/en-us/windows/wsl/)
- [DBeaver Community](https://dbeaver.io/)

---

## üíå **Nota Personal**

**Esta gu√≠a fue creada bas√°ndose en problemas REALES encontrados durante la configuraci√≥n. Cada error, soluci√≥n y "momento de frustraci√≥n" fue documentado para ayudar a otros desarrolladores que enfrentan los mismos desaf√≠os en Windows.**

**¬°Especial agradecimiento por la paciencia durante el proceso de debugging! ü§ó**

---

**üìÖ √öltima actualizaci√≥n:** Junio 2025  
**üéØ Estado:** Completamente funcional y probado  
**üíª Entorno:** Windows 11 + WSL 2 + Docker Desktop + Laravel Sail
